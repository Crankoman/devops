# Домашнее задание к занятию «Компоненты Kubernetes»

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

<-- Ответ

1. Предпологаем что есть как минимум 3 окружения DEV, TEST и PROD(в своих неймспейсах) выберем стратегию, что все они будут в рамках одного кластера на всех нодах. Так же учитываем, что в кластере должно быть минимум три ноды. Выбираем подход когда одна нода обладает ресурсами для того, что бы поддержить все развернутые поды. Считаем что данные подов хранятся на присоеденном сетевом хранилеще.
Подсчитаем:
- Для работы OS (Debian) требуется: 1000m core, 0,6GB ram, 5GB HDD.
- Минимальные требования к мастер ноде: 2000m core, 4GB ram, 40GB HDD.
- Добавим резерв виде минального требования к воркер ноде: 2000m core, 2GB ram, 40GB HDD.
Теперь требования к воркер ноде:
- БД: 1000m core, 4GB ram  x 3 x 3(три окружения) = 9000m, 27GB
- Сервис кеширования: 1000m core, 4GB ram  x 3 x 3(три окружения) = 9000m, 27GB
- Front: 200m core, 0.05GB ram  x 5 x 3(три окружения) = 3000m, 0,75GB
- Backend: 200m core, 0.05GB ram  x 10 x 3(три окружения) = 6000m, 1,5GB
Итого: 27000m, 56,25GB добавим резерв в 20% = 32400m, 67,5GB считаем что на ноду хватит 500GB HDD для локальных данных


Исходя из этих требований расчитиаем через [гугл таблицу](https://docs.google.com/spreadsheets/d/1HudOge4q1uJ4TjlKEHAqbmMyg9RvIf3BEM80vCQB-5A/edit#gid=0) переменные расходы на воркерноду составят:
- 151m, 5,76GB
Итого требования к 1 ВМ на которой будет развернут 1 мастернода и 1 воркернода + 25% свободных ресурсов составят:
51 000m CPU, 107GB RAM, 800GB HDD

Мой расчет учитывает что справится и одна нода. Добавлены 20% к требованиям подов и 25% свободного места на ВМ.

3 ВМ(по одной ноде на каждой) по 51 core, 107GB RAM, 800GB HDD + сетевое хранилище.
  
----